<div class="flex flex-col h-full">
  <div class="flex items-center justify-between px-6 pb-6 bg-white dark:bg-[#1C2736] border-b border-b-[#F2F4F7] dark:border-b-[#36455899]">
    <div class="relative w-2/5 shrink-0">
      <input
        class="w-full h-12 pl-[65px] pr-[26px] rounded-[10px] bg-[#F8F8F8] dark:bg-[#4D5669] border-0 focus:outline-0 placeholder:text-[#667085] dark:placeholder:text-[#D0D5DD] text-[#101828] dark:text-[#D0D5DD]"
        type="search"
        [placeholder]="'search.for.assignments'| translate"
        [(ngModel)]="search"
        (keydown.enter)="searchTasks()"
      >

      <mat-icon class="absolute left-[26px] top-[11px] dark:text-[#D0D5DD]" [svgIcon]="'icon:search'"/>
    </div>

    <div class="flex items-center gap-6">
      <div
        class="flex items-center justify-center h-12 px-6 gap-3 border border-[#F2F4F7] dark:border-[#4D5669] rounded-[10px] cursor-pointer"
        mat-ripple
        #filterButton
        (click)="overlayPanel.openPanel()"
      >
        <mat-icon class="text-[#667085] dark:text-[#667085]" [svgIcon]="'icon:filter'"/>
        <div class="flex items-center gap-2 font-semibold text-[#101828] dark:text-[#F2F4F7]">
          <div>{{ 'the.main.goal'| translate }}: </div>
          <div class="line-clamp-1 max-w-48" [title]="rootObjectiveName| translate">{{ rootObjectiveName| translate }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-col grow p-6 bg-[#F8F8F8] dark:bg-[#101828]">
    <div class="flex items-center justify-between mb-6 pl-4 pr-2 rounded-[8px] bg-white dark:bg-[#1C2736]">
      <div class="flex">
        @for (tab of tabs; track tab) {
          <div
            [routerLink]="['./', tab.link]"
            [queryParamsHandling]="cameFromNotification ? null : 'preserve'"
            [routerLinkActive]="'after:bg-[#9E77ED]'"
            class="relative flex items-center gap-3 text-[#141522] dark:text-white font-medium px-4 py-5 cursor-pointer after:absolute after:bottom-0 after:left-0 after:w-full after:h-[2px]"
            mat-ripple
          >
            <mat-icon [svgIcon]="'icon:' + tab.icon"/>
            <span>{{ tab.text| translate }}</span>
            <span
              class="text-gray-500 dark:text-[#e4e7ec]">({{ tab.link }})</span>
          </div>
        }
      </div>

      <div
        class="flex items-center justify-center h-12 px-6 rounded-[10px] cursor-pointer text-white font-semibold bg-[#9E77ED]"
        mat-ripple
        (click)="currentTab === 'objectives' ? openObjectiveManageModal() : openKeyResultsManageModal()"
      >
        {{ (currentTab === 'objectives' ? 'add.objective': 'add.task')| translate }}
      </div>
    </div>

    <router-outlet/>
  </div>
</div>

<overlay-panel
  [originElement]="filterButton" #overlayPanel>
  <div
    class="mt-2 rounded-lg shadow-lg py-2 bg-white text-[#667085] border border-[#F2F4F7] dark:bg-[#4D5669] dark:border-none"
    overlay-content>
    @for (rootObjective of rootObjectives; track rootObjective) {
      <div
        [ngClass]="{
          'bg-[#F2F4F7] dark:bg-[#1C2736]': rootObjective.id === rootObjectiveId
        }"
        (click)="selectRootObjectiveId(rootObjective.id, overlayPanel._overlayRef)"
        class="flex items-center py-3 px-5 gap-2.5 hover:bg-[#F2F4F7] dark:hover:bg-[#1C2736] font-medium cursor-pointer text-[#101828] dark:text-white" mat-ripple>
        <span>{{ rootObjective.title| translate }}</span>
      </div>
    }
  </div>
</overlay-panel>
