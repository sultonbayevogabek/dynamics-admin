<div class="flex flex-col h-full">
  <div class="flex items-center justify-between px-6 pb-6 bg-white border-b border-b-[#F2F4F7] dark:border-b-[#36455899] dark:bg-[#1C2736]">
    <div class="flex items-center gap-3">
      <div class="relative w-[300px] shrink-0">
        <input
          class="w-full h-12 pl-[65px] pr-[26px] rounded-[10px] bg-[#F8F8F8] dark:bg-[#4D5669] border-0 focus:outline-0 placeholder:text-[#667085] dark:placeholder:text-[#D0D5DD] text-[#101828] dark:text-[#D0D5DD]"
          type="search"
          [placeholder]="'search.for.members'| translate"
          [(ngModel)]="params.search"
          (keydown.enter)="search()"
        >

        <mat-icon class="absolute left-[26px] top-[11px] dark:text-[#D0D5DD]" [svgIcon]="'icon:search'"/>
      </div>

      <mat-select
        [(ngModel)]="params.department_ids"
        [placeholder]="'departments'| translate"
        class="outlined-select departments"
        [multiple]="true"
        (selectionChange)="search()"
      >
        @for (department of departments; track department) {
          <mat-option [value]="department?.id">{{ department?.department_name }}</mat-option>
        }
      </mat-select>
    </div>

    <div class="flex items-center gap-6">
      <div
        *hasPermissions="['admin']"
        class="flex items-center justify-center h-12 px-6 gap-3 border border-[#F2F4F7] dark:border-[#4D5669] rounded-[10px] cursor-pointer"
        mat-ripple
        (click)="openAddNewMemberDialog()"
      >
        <mat-icon class="text-[#667085] dark:text-[#667085] icon-size-28" [svgIcon]="'icon:outline-plus'"/>
        <span class="font-semibold text-[#101828] dark:text-[#F2F4F7]">
          {{ 'add.new.member'| translate }}
        </span>
      </div>

      <div
        class="flex items-center justify-center h-12 px-6 gap-3 border border-[#F2F4F7] dark:border-[#4D5669] rounded-[10px] cursor-pointer"
        mat-ripple
        (click)="viewType === 'grid' ? viewType = 'list' : viewType = 'grid'"
      >
        @if (viewType === 'grid') {
          <mat-icon class="text-[#667085] dark:text-[#667085]" [svgIcon]="'icon:layout-card'"/>
        } @else {
          <mat-icon class="text-[#667085] dark:text-[#667085]" [svgIcon]="'icon:layout-list'"/>
        }

        <span class="font-semibold text-[#101828] dark:text-[#F2F4F7]">
          {{ 'layout'| translate }}: {{ (viewType === 'grid' ? 'card' : 'list')| translate }}
        </span>
      </div>

      <div
        class="flex items-center justify-center h-12 px-6 gap-3 border border-[#F2F4F7] dark:border-[#4D5669] rounded-[10px] cursor-pointer"
        mat-ripple
        #filterButton
        (click)="overlayPanel.openPanel()"
      >
        <mat-icon class="text-[#667085] dark:text-[#667085]" [svgIcon]="'icon:filter'"/>
        <div class="flex items-center gap-2 font-semibold text-[#101828] dark:text-[#F2F4F7]">
          <div>{{ 'the.main.goal'| translate }}: </div>
          <div class="line-clamp-1 max-w-40" [title]="params?.root_objective_name| translate">{{ params?.root_objective_name| translate }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="flex flex-col gap-5 grow p-6 dark:bg-[#101828]">
    <div class="relative grow">
      @if (viewType === 'grid') {
        <div
          class="grid lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 place-content-start gap-5 absolute inset-0 overflow-auto"
        >
          @for (member of members; track member) {
            <members-card
              [member]="member"
              (click)="openMemberDetailsDialog(member)"
            />
          }
        </div>
      }
      @if (viewType === 'list') {
        <div class="absolute inset-0 overflow-auto">
          <members-table
            [members]="members"
            (onMemberSelected)="openMemberDetailsDialog($event)"
          />
        </div>
      }
    </div>

    <div class="flex items-center justify-between h-16 px-4 bg-white dark:bg-[#1C2736] rounded-[12px]">
      <pagination
        [collectionSize]="params.total"
        [pageSize]="params.limit"
        (onPageChange)="changePage($event)"
      />

      <div class="flex items-center gap-3">
        <div class="text-[#101828] dark:text-white shrink-0">
          {{ (params.page - 1) * params.limit + 1 }}-{{ params.page * params.limit >= params.total ? params.total : params.page * params.limit }}/{{ params.total }}
        </div>

        <mat-select
          [(ngModel)]="params.limit"
          class="outlined-select"
          [hideSingleSelectionIndicator]="true"
          (selectionChange)="onLimitChange()"
        >
          <mat-option [value]="15">{{ 'show'| translate }} 15</mat-option>
          <mat-option [value]="20">{{ 'show'| translate }} 20</mat-option>
          <mat-option [value]="25">{{ 'show'| translate }} 25</mat-option>
        </mat-select>
      </div>
    </div>
  </div>
</div>

<overlay-panel
  [originElement]="filterButton" #overlayPanel>
  <div
    class="mt-2 rounded-lg shadow-lg py-2 bg-white text-[#667085] border border-[#F2F4F7] dark:bg-[#4D5669] dark:border-none"
    overlay-content>
    @for (rootObjective of rootObjectives; track rootObjective) {
      <div
        [ngClass]="{
          'bg-[#F2F4F7] dark:bg-[#1C2736]': rootObjective.id === params.root_objective_id
        }"
        (click)="selectRootObjectiveId(rootObjective.id, overlayPanel._overlayRef)"
        class="flex items-center py-3 px-5 gap-2.5 hover:bg-[#F2F4F7] dark:hover:bg-[#1C2736] font-medium cursor-pointer text-[#101828] dark:text-white" mat-ripple>
        <span>{{ rootObjective.title| translate }}</span>
      </div>
    }
  </div>
</overlay-panel>
